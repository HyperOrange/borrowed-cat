{% extends 'base.html' %}
{% load static %}

{% block title %}팀플 관리{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
{% endblock %}

{% block content %}
    <div class="main-container">
        <header class="main-header">
            <div class="team-info">
                <span class="team-name">{{ team.team_name }}</span>
            </div>
            <div class="header-actions">
                <button class="share-button-bg">
                    <i class="fas fa-link"></i>
                </button>
            </div>
        </header>

        <div class="progress-bar-container">
            <div class="progress-bar" style="width: 0%;"></div>
            <span class="progress-text">0%</span>
        </div>

        <div class="member-list-container">
            {% for member in team.members.all %}
            <a href="{% url 'team:edit_member' team_id=team.team_id member_id=member.id %}" class="member-item member-link">
                <div class="member-profile">
                    <img src="{% static 'img/' %}{{ member.profile_image }}" alt="{{ member.nickname }}" class="member-cat-img">
                </div>
                <div class="member-role-box">
                    <span class="member-role-text">{{ member.nickname }}</span>
                    {% if member.tags %}
                        <p class="member-tags">{{ member.tags }}</p>
                    {% endif %}
                </div>
            </a>
            {% empty %}
                <p class="no-members-text">팀원이 아직 없습니다. 아래 버튼을 눌러 팀원을 추가하세요.</p>
            {% endfor %}
            
            <a href="{% url 'team:add_member' team_id=team.team_id %}" 
            class="member-item add-member" style="text-decoration: none !important;">
                <div class="member-profile add-button-circle">
                    <i class="fas fa-plus add-icon"></i>
                </div>
                <div class="member-role-box add-member-text">
                    <span class="member-role-text">팀원으로 참가하기</span>
                </div>
            </a>
        </div>

        <div class="button-grid">
            <button class="grid-button">To-Do list</button>
            <button class="grid-button">스케줄 확인하기</button>
            <button class="grid-button">역할 설정하기</button>
            <button class="grid-button">D-day</button>
            <a href="{% url 'core:index' %}" class="grid-button styled-link">새 팀플 시작하기</a>
            <button class="grid-button">링크 모음</button>
        </div>
    </div>

    <style>
        .member-link {
            text-decoration: none;
            color: inherit;
            transition: transform 0.2s ease;
        }
        
        .member-link:hover {
            transform: translateY(-2px);
        }
        .styled-link {
            /* Remove underline */
            text-decoration: none !important;
            /* Make the link behave like a flexbox for content centering */
            display: flex;
            justify-content: center;
            align-items: center;
            /* Match the height of other buttons */
            height: 40px; 
            /* Match button padding */
            padding: 20px 10px; 
        }
    </style>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const shareButton = document.querySelector('.share-button-bg');
        if (shareButton) {
            shareButton.addEventListener('click', function() {
                const urlToCopy = window.location.href;
                
                // 클립보드에 URL 복사
                navigator.clipboard.writeText(urlToCopy).then(function() {
                    alert('팀플 링크가 복사되었습니다!');
                }).catch(function(err) {
                    console.error('클립보드 복사 실패:', err);
                    alert('클립보드 복사에 실패했습니다. 직접 URL을 복사해주세요.');
                });
            });
        }
    });
</script>
{% endblock %}