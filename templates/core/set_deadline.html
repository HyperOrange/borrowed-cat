{% extends 'base.html' %}
{% load static %}

{% block head %}
<link href="https://cdn.jsdelivr.net/npm/vanilla-calendar-pro/styles/index.css" rel="stylesheet">
<style>
    /* 달력 위 공간 줄이기 */
    .date-setting-container {
        padding: 20px;
        max-width: 480px;
        margin: 0 auto;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        height: 100vh;
    }
    
    .page-header { 
        margin-bottom: 20px; 
        flex-shrink: 0; /* 헤더 크기 고정 */
    }
    
    .page-title { 
        font-size: 24px; 
        font-weight: 700; 
        color: #222; 
    }
    
    /* 중앙 컨텐츠 영역 */
    .content-center {
        flex: 1; /* 남은 공간 모두 차지 */
        display: flex;
        flex-direction: column;
        justify-content: center; /* 수직 중앙 정렬 */
        align-items: center; /* 수평 중앙 정렬 */
        gap: 30px; /* 날짜와 시간 선택 사이 간격 */
        padding: 20px 0;
    }
    
    .calendar-container {
        width: 100%;
        max-width: 350px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .time-picker-container {
        width: 100%;
        max-width: 350px;
        text-align: center;
    }
    
    .time-picker-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .time-input {
        padding: 12px;
        font-size: 16px;
        width: 120px;
        border: 2px solid #ddd;
        border-radius: 8px;
        background: white;
    }
    
    .time-separator { 
        font-size: 16px; 
        color: #666; 
    }
    
    .time-picker-title {
        font-size: 16px;
        color: #333;
        margin-bottom: 15px;
        font-weight: 500;
    }
    
    /* 하단 버튼 영역 */
    .button-area {
        flex-shrink: 0; /* 버튼 영역 크기 고정 */
        padding: 20px 0;
    }
    
    .start-button {
        display: block;
        width: 92%;
        max-width: 520px;
        min-width: 260px;
        margin: 0 auto;
        padding: 14px 18px;
        background: #f4c043;
        color: #fff;
        border: none;
        border-radius: 34px;
        font-weight: 800;
        font-size: 18px;
        text-align: center;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        white-space: nowrap;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    
    .start-button:hover {
        background: #f2b632;
    }
    
    .start-button:active {
        background: #f0a500;
    }
    
    /* 선택된 날짜 스타일 */
    .selected-date {
        background-color: #f4c043 !important;
        color: white !important;
        border-radius: 4px;
    }
</style>
{% endblock %}

{% block content %}
<div class="date-setting-container">
    <header class="page-header">
        <h1 class="page-title">팀플 기간 설정</h1>
    </header>
    
    <!-- 중앙 컨텐츠 영역 -->
    <div class="content-center">
        <form action="{% url 'set_deadline' %}" method="post" id="deadline-form">
            {% csrf_token %}
            <div class="calendar-container">
                <!-- 기본 HTML date input으로 교체 -->
                <div style="text-align: center;">
                    <label for="deadline_date" style="display: block; margin-bottom: 10px; font-size: 16px; color: #333;">마감 날짜 선택</label>
                    <input type="date" name="deadline_date" id="deadline_date" 
                           style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 8px; background: white;" 
                           required>
                </div>
            </div>
            <div class="time-picker-container">
                <div class="time-picker-title">마감 시간 설정</div>
                <div class="time-picker-wrapper">
                    <input type="time" name="deadline_time" id="deadline_time" class="time-input" required>
                    <span class="time-separator">까지</span>
                </div>
            </div>
        </form>
    </div>
    
    <!-- 하단 버튼 영역 -->
    <div class="button-area">
        <button type="submit" form="deadline-form" class="start-button">시작하기</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    // 기본 date input 사용으로 달력 라이브러리 제거
    const dateInput = document.getElementById('deadline_date');
    
    // 오늘 날짜를 최소값으로 설정 (과거 날짜 선택 불가)
    const today = new Date().toISOString().split('T')[0];
    dateInput.min = today;
    
    console.log('날짜 입력 필드 설정 완료. 최소 날짜:', today);

    // 제출 전 날짜와 시간 선택 여부 확인
    document.getElementById('deadline-form').addEventListener('submit', (e) => {
        const dateVal = document.getElementById('deadline_date').value;
        const timeVal = document.getElementById('deadline_time').value;
        
        // 디버깅용 콘솔 출력
        console.log('=== 폼 제출 시 체크 ===');
        console.log('제출 시 날짜 값:', dateVal);
        console.log('제출 시 시간 값:', timeVal);
        console.log('날짜 값 존재 여부:', !!dateVal);
        console.log('시간 값 존재 여부:', !!timeVal);
        
        if (!dateVal || !timeVal) {
            e.preventDefault();
            alert('마감 날짜와 시간을 꼭 선택해주세요!');
            return false;
        }
    });
});
</script>
{% endblock %}